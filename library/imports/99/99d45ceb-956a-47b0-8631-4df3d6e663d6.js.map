{"version":3,"sources":["../../../../assets/Script/assets/Script/number.js"],"names":["cc","Class","extends","Component","properties","labelArray","default","type","Sprite","textureArray","SpriteFrame","numberArray","Node","m_speed","m_isFirst","m_distance","m_moveCountDis","m_delta","m_oldData","m_newData","m_height","goNextNode","onLoad","initNumber","number","i","length","label","setOneNumber","node","y","initData","destCount","unitNumber","parseInt","getComponent","setArrayNumber","resetZero","scriptS","update","dt","round","nextPluss","count","plusCount","setNum","subMoveSpeed","movePlus","oldNu","m_number","newNu","speed","j","justPos","shift","push","spriteFrame"],"mappings":"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","file":"number.js","sourceRoot":"../../../../assets/Script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n       labelArray:{\n            default:[],\n            type:[cc.Sprite],\n       },\n       //\n       textureArray:{\n            default:[],\n            type:[cc.SpriteFrame],\n       },\n       numberArray:{\n            default:[],\n            type:[cc.Node],\n        },\n       m_speed:1,\n       m_isFirst: true,\n       m_distance:0,\n       m_moveCountDis:0,\n       m_delta:0,\n       m_oldData: 0,\n       m_newData: 0,\n       m_height:0,\n       goNextNode:\n       {\n           default: null,\n           type: cc.Node,\n       },\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.m_height = 70;\n        //cc.game.setFrameRate(1);\n        this.initNumber(0);\n    },\n    \n    initNumber:function(number){\n        for(let i = 0; i < this.labelArray.length; i++){\n            let label = this.labelArray[i]\n            this.setOneNumber(label,(number + i));\n            label.node.y = i * this.m_height;\n        }\n    },\n\n    initData:function(destCount){\n        if(destCount >= this.m_newData){\n            this.m_distance += (destCount - this.m_newData) * this.m_height;\n            this.m_newData = destCount;\n        }else{\n            this.m_newData = destCount;\n            this.m_oldData = destCount;\n            for(var i = 0; i < this.numberArray.length; i++){\n                var unitNumber = destCount % 10;\n                destCount = parseInt(destCount / 10);\n                this.numberArray[i].getComponent(\"number\").setArrayNumber(unitNumber);\n            }   \n        }\n        \n    },\n    //中奖池奖之后直接设置数字\n    setArrayNumber:function(number){\n        this.m_delta = 0;\n        this.m_distance = 0;\n        this.m_moveCountDis = 0;\n        this.initNumber(number);\n    },\n\n    //奖池归零\n    resetZero:function(){\n        this.initNumber(0);\n        this.m_oldData = 0;\n        this.m_newData = 0;\n        this.m_moveCountDis = 0;\n        this.m_distance = 0;\n        if(this.goNextNode){\n            var scriptS = this.goNextNode.getComponent(\"number\");\n            scriptS.resetZero();\n        }\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        if(this.m_distance > 0){\n            this.round();\n        }   \n    },\n    \n    nextPluss:function(count){\n        this.m_distance += count * this.m_height; \n    },\n\n    //round\n    round:function(){\n        this.m_speed = this.m_distance / 15;\n        //针对差值太大对速度进行处理 比如奖池变化从0到9000000\n        if(this.m_speed < 1){//最小速度限制\n            this.m_speed = 1;\n        }\n        this.m_distance -= this.m_speed;\n        this.m_moveCountDis+= this.m_speed;\n        if(this.m_moveCountDis > this.m_height * 10){//进位判断\n            let plusCount = parseInt(this.m_moveCountDis / (this.m_height * 10));\n            this.m_moveCountDis -= (this.m_height * 10)*plusCount;\n            //进位判断\n            if(this.goNextNode){\n                var scriptS = this.goNextNode.getComponent(\"number\");\n                scriptS.nextPluss(plusCount);\n            }\n        } \n        if(this.m_speed >= 60){//针对速度非常快 比如0变到900000000\n            //首先做进位运算\n            var count = parseInt(this.m_speed / this.m_height);//进位数\n            this.m_oldData += count;\n            this.setNum(count);\n            var subMoveSpeed = this.m_speed - count * this.m_height;//进位之后的move\n            this.movePlus(subMoveSpeed);\n        }else{//速度很小\n            this.movePlus(this.m_speed);\n        }\n    },\n    //滚动时逻辑\n    setNum:function(count){\n        for(let i = 0; i < this.labelArray.length; i++){\n            let label = this.labelArray[i];\n            var oldNu = parseInt(label.m_number);\n            var newNu = (oldNu + count) % 10;\n            this.setOneNumber(label,newNu);\n        }\n    },\n\n    //move plus\n    movePlus:function(speed){\n        var j = this.labelArray.length;\n        for(let i = 0; i < j; i++){\n            let label = this.labelArray[i];\n            label.node.y -= speed;\n            if(label.node.y <= -(this.m_height * 2)){\n                this.m_delta = -(this.m_height*2) - label.node.y;\n                this.justPos();\n                i = -1;\n                j--;\n            }\n        }\n    },\n\n    //\n    justPos:function(){\n        if(this.m_isFirst){\n            this.m_oldData ++;\n        }\n        let label = this.labelArray.shift();\n        let number = label.m_number;\n        number = (number + 4) % 10;\n        this.setOneNumber(label,number);\n        label.node.y = (this.m_height * 2) - this.m_delta;\n        this.labelArray.push(label);\n    },\n    //设置某一个数字\n    setOneNumber:function(label,number){\n        number = number%10;\n        label.m_number = number;\n        label.spriteFrame = this.textureArray[number];\n    }\n});\n"]}