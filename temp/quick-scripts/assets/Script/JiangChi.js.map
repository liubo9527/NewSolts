{"version":3,"sources":["JiangChi.js"],"names":["NetData","require","Common","cc","Class","extends","Component","properties","firstNumber","default","type","Node","boomScreen","spine","poolOther","detailLabelNode","detailLabelTop","Label","detailLabelDown","detailIndex","detailArray","detailArrayTop","detailArrayDown","flag","allActionHasFinished","index","onLoad","startboomScreenAction","active","moveTo","p","easing","easeBounceOut","finish","callFunc","playBoomScreen","seq","sequence","delayTime","runAction","getComponent","setAnimation","string","scale","scaleTo","fadeOut","spawn","nextplayBoomScreen","actionArray","push","fadeIn","length","boomFinish","boomScreenFinished","easeBounceIn","boomScreenMoveUpFinished","startPoolOtherAction","poolNodeJumpFinish","initData","count","initResult","getInst","InitResult","historyPool","setDetailArrayString","theUnit","self","i","j","downStrIndex","indexOf","downStr","substring","cutStr","indexOne","subString","indexTwo","uid","getNick","jj","nick","uidCopy","newId","newstr","replace"],"mappings":"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","file":"JiangChi.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var NetData = require(\"NetData\");\nvar Common = require(\"Common\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        firstNumber:{\n            default:null,\n            type:cc.Node,\n        },\n        boomScreen:{\n            default:null,\n            type:cc.Node,\n        },\n        spine:{\n            default:null,\n            type:cc.Node,\n        },\n        poolOther:{\n            default:null,\n            type:cc.Node,\n        },\n        detailLabelNode:{\n            default:null,\n            type:cc.Node,\n        },\n        detailLabelTop:{\n            default:null,\n            type:cc.Label,\n        },\n        detailLabelDown:{\n            default:null,\n            type:cc.Label,\n        },\n        detailIndex:0,//爆屏索引\n        detailArray:[],//服务器给的字段\n        detailArrayTop:[],//爆屏信息上部分字体\n        detailArrayDown:[],//爆屏信息下部分字体\n\n        flag:false,//已经打开奖池爆屏\n        allActionHasFinished:false,//爆屏和奖池出现动画都播放完毕\n        index:0,//\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n    },\n\n    /*******爆屏 */\n    startboomScreenAction:function(){\n        this.boomScreen.active = true;\n        this.poolOther.active = false;\n        var moveTo = cc.moveTo(1, cc.p(0,0)).easing(cc.easeBounceOut(3.0));\n        var finish = cc.callFunc(this.playBoomScreen, this);\n        var seq = cc.sequence(cc.delayTime(1),moveTo,finish);\n        this.boomScreen.runAction(seq);\n    },\n    playBoomScreen:function(){\n        this.detailIndex++;\n        this.spine.getComponent('sp.Skeleton').setAnimation(0, 'animation2', false);\n        this.detailLabelTop.string = this.detailArrayTop[this.detailIndex - 1];\n        this.detailLabelDown.string = this.detailArrayDown[this.detailIndex - 1];\n        this.detailLabelNode.scale = 1;\n        var scaleTo = cc.scaleTo(0.4,1.5);\n        var fadeOut = cc.fadeOut(0.4);\n        var spawn = cc.spawn(scaleTo,fadeOut);\n        var finish = cc.callFunc(this.nextplayBoomScreen, this);\n        var actionArray = [];\n        actionArray.push(cc.delayTime(0.08));\n        actionArray.push(cc.fadeIn(0));\n        actionArray.push(cc.delayTime(3));\n        actionArray.push(spawn);\n        actionArray.push(cc.delayTime(1));\n        actionArray.push(finish);\n        if(this.detailIndex == this.detailArray.length){\n            var boomFinish = cc.callFunc(this.boomScreenFinished, this);\n            actionArray.push(boomFinish);\n        }\n        var seq = cc.sequence(actionArray);\n        this.detailLabelNode.runAction(seq);\n    },\n   \n    nextplayBoomScreen:function(){\n        if(this.detailIndex < this.detailArray.length){\n            this.playBoomScreen();\n        }\n    },\n     //BoomScreen 播放完毕\n     boomScreenFinished:function(){\n        var moveTo = cc.moveTo(0.5, cc.p(0,276)).easing(cc.easeBounceIn(3.0));\n        var finish = cc.callFunc(this.boomScreenMoveUpFinished, this);\n        var seq = cc.sequence(moveTo,finish);\n        this.boomScreen.runAction(seq);\n    },\n    //爆屏收回去了\n    boomScreenMoveUpFinished:function(){\n        this.startPoolOtherAction();\n    },\n\n    /*******奖池奖 */\n    startPoolOtherAction:function(){\n        this.boomScreen.active = false;\n        this.poolOther.active = true;\n        var moveTo = cc.moveTo(1, cc.p(0,0)).easing(cc.easeBounceOut(3.0));\n        var finish = cc.callFunc(this.poolNodeJumpFinish, this);\n        var seq = cc.sequence(cc.delayTime(1),moveTo,finish);\n        this.poolOther.runAction(seq);\n    },\n    //pool\n    poolNodeJumpFinish:function(){\n        this.allActionHasFinished = true;\n    },\n\n    initData:function(count)\n    {   \n        if(this.flag == false){//爆屏只开启一次\n            this.flag = true;\n            var initResult= NetData.NetData.getInst().InitResult;\n            this.detailArray = initResult.historyPool;\n            if(this.detailArray.length > 0){\n                this.setDetailArrayString();\n            }else{\n                //直接播放奖池奖动画\n                this.startPoolOtherAction();\n            }\n        }   \n        if(this.allActionHasFinished == true){\n            var theUnit = this.firstNumber.getComponent(\"number\");\n            theUnit.initData(count);\n        } \n    },\n    //取得用户的昵称\n    setDetailArrayString:function(){\n        var self = this;\n        this.index = 0;\n        this.detailArrayDown = [];\n        this.detailArrayTop = [];\n        for(let i = 0; i < this.detailArray.length; i++){\n            var j = i;\n            var downStrIndex =  this.detailArray[j].indexOf(\"##\");\n            var downStr = this.detailArray[j].substring(downStrIndex + 2);\n            this.detailArrayDown.push(downStr);\n            //下部分\n            var cutStr = this.detailArray[j].substring(downStrIndex, -downStrIndex);\n            this.detailArrayTop.push(cutStr);\n            var indexOne = cutStr.indexOf(\"$\");\n            var subString =  cutStr.substring(indexOne + 1);\n            var indexTwo = subString.indexOf(\"$\");\n            var uid = subString.substring(indexTwo, -indexTwo);\n            Common.Common.getInst().getNick(j,uid, function(jj,nick,uidCopy){//异步的\n                var newId = \"$\" + uidCopy + \"$\";\n                var newstr = self.detailArrayTop[jj].replace(newId, nick);\n                self.detailArrayTop[jj] = newstr;\n                self.index++;\n                if(self.index == self.detailArray.length){\n                    self.startboomScreenAction();\n                }\n            });\n        }\n    }, \n    \n});\n"]}