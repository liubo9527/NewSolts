{"version":3,"sources":["unit.js"],"names":["cubeS","require","Game","cc","Class","extends","Component","properties","unitIndex","cube_array","m_controlSpeed","m_speed","m_moveDis","m_start","m_deltaDis","m_totalDis","m_stopDis","m_stopFlag","stopData_array","dataIndex","onceFlag","isSpecialModel","onFunction","nameArray","onLoad","find","getComponent","i","cubeName","cube","node","getChildByName","cubeScript","rand","parseInt","Math","random","nameStr","setCube","push","startRound","hiddleCube","stopAni","setStopDataArray","index","concat","setIsSpecialModel","flag","update","dt","soltsRound","getCubeArray","y","restPosAndArray","kickAction","outDis","moveBy","p","callback","callFunc","judgeLastRound","seq","sequence","runAction","scheduleOnce","allRoundEnded","playAni","setUnitSpecialModel","roundEnded","tempCube","shift","stopRound"],"mappings":"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","file":"unit.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var cubeS = require(\"cube\");\nvar Game = require(\"Game\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        unitIndex:-1,\n\n       cube_array:[],\n       m_controlSpeed:1000,//控制加速\n       m_speed:0,//当前速度\n       m_moveDis:0,//移动距离\n       m_start:false,\n       m_deltaDis:0,\n       \n       m_totalDis:0,\n       m_stopDis:0,\n       m_stopFlag:false,\n       stopData_array:[],\n       dataIndex:0,\n       onceFlag:false,\n       isSpecialModel:false,//大丰收模式\n       onFunction:null,\n       nameArray:null,//\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.onFunction = cc.find('Canvas').getComponent('Game');\n        this.cube_array = [];\n        this.nameArray = [\"WW\",\"FG\",\"M1\",\"M2\",\"M3\",\"F4\",\"F5\",\"F6\",\"F7\",\"F8\"];\n        this.m_controlSpeed = 1000;\n        for(var i = 0; i < 6; i++){\n            var cubeName = \"cube\" + \"\"+(i+1);\n            var cube = this.node.getChildByName(cubeName);\n            var cubeScript = cube.getComponent(cubeS);\n            var rand = parseInt(Math.random()*10);\n            var nameStr = this.nameArray[rand];\n            cubeScript.setCube(nameStr);\n            this.cube_array.push(cube);\n        }\n        this.m_start = false;\n    },\n\n    startRound:function(){\n        this.onceFlag = false;\n        this.m_speed = 200;\n        this.m_controlSpeed = 2000;\n        this.dataIndex = 0;\n        this.m_start = true;\n        this.m_stopFlag = false;\n        this.m_stopDis = 0;\n    },\n\n   hiddleCube:function(){\n        this.isSpecialModel = false;\n        for(var i = 5; i >= 0; i--){\n            var cube = this.cube_array[i];\n            cube.getComponent(cubeS).stopAni();\n        }\n    },\n\n    setStopDataArray:function(stopData_array, index,isSpecialModel){\n        this.nameArray = [\"WW\",\"FG\",\"M1\",\"M2\",\"M3\",\"F4\",\"F5\",\"F6\",\"F7\",\"F8\"];\n        if(index == 1){\n            this.isSpecialModel = isSpecialModel;\n        }else{\n            this.isSpecialModel = false;\n        }\n        this.stopData_array = null;\n        this.stopData_array = stopData_array.concat();\n        //最后放2个随机图\n        for(var i = 0; i < 2; i++){\n            var rand = parseInt(Math.random()*10);\n            var nameStr = this.nameArray[rand];\n            this.stopData_array.push(nameStr);\n        }\n        this.unitIndex = index;\n    },\n\n    setIsSpecialModel:function(flag){\n        this.isSpecialModel = flag;\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        if(this.m_start){\n            this.soltsRound(dt);\n        }\n    },\n\n    getCubeArray:function(){\n        return  this.cube_array;\n    },\n    \n    //soltsRound\n    soltsRound:function(dt){\n        if(dt > 0.032){\n            dt = 0.032;\n        }\n        this.m_speed = this.m_speed + (this.m_controlSpeed - this.m_speed) * dt * 4;\n        this.m_moveDis = this.m_speed * dt;\n        this.m_totalDis += this.m_moveDis;\n        for(var i = 5; i >= 0; i--){\n            var cube = this.cube_array[i];\n            cube.y = cube.y - this.m_moveDis;\n            if(cube.y < - 112.5){//换顺序  \n                this.m_deltaDis = -112.5 - cube.y;\n                this.restPosAndArray();\n            }\n        }\n        if((this.m_stopDis + 60 <= this.m_totalDis) && this.m_stopFlag === true){\n            this.m_start = false;\n            //回弹\n            this.kickAction();\n        }\n    },\n\n\n    \n    kickAction:function(){\n        var outDis = 112.5- this.cube_array[0].y;\n        this.onceFlag = false;\n        for(var i = 0; i < 6; i++){\n            var cube = this.cube_array[i];\n            var moveBy = cc.moveBy(0.1, cc.p(0,outDis));\n            let callback = cc.callFunc(this.judgeLastRound, this);\n            let seq = cc.sequence(moveBy,callback)\n            cube.runAction(seq); \n        }\n    },\n\n    judgeLastRound:function(){\n        if((this.unitIndex == 5) &&(this.dataIndex == 6)){\n            if(this.onceFlag == false){\n                this.onceFlag =true;\n                this.scheduleOnce(this.allRoundEnded, 1);\n            }\n        }else{\n            if((this.isSpecialModel == true) && (this.unitIndex == 1) && (this.dataIndex == 6) ){\n                this.cube_array[3].getComponent(cubeS).playAni();\n                this.cube_array[2].getComponent(cubeS).playAni();\n                this.cube_array[1].getComponent(cubeS).playAni();\n                this.cube_array[0].getComponent(cubeS).playAni();\n                this.onFunction.setUnitSpecialModel();\n            }\n           \n        }\n    },\n    \n    allRoundEnded:function(){\n        this.onFunction.roundEnded();\n    },\n    //\n    restPosAndArray:function(){\n        var tempCube = this.cube_array.shift()\n        tempCube.y = 1237.5 - this.m_deltaDis;\n        this.cube_array.push(tempCube);\n        var nameStr = \"\";\n        if(this.m_stopFlag == false){\n            var rand = parseInt(Math.random()*10);\n            nameStr = this.nameArray[rand];\n        }else{\n            var nameStr = this.stopData_array[this.dataIndex];\n            if((this.isSpecialModel == true) && (nameStr == \"WW\") && (this.dataIndex < 4) && (this.unitIndex!= 1)){\n                tempCube.getComponent(cubeS).playAni();\n            }\n            this.dataIndex++;\n        }\n        tempCube.getComponent(cubeS).setCube(nameStr);\n    },\n    \n    stopRound:function(){\n        if(this.m_stopFlag == false){\n            this.m_controlSpeed = 500;\n            this.m_stopDis = this.cube_array[5].y - 112.5;\n            this.m_stopFlag = true;\n            this.m_totalDis = 0;\n            //换第一个\n            var nameStr = this.stopData_array[this.dataIndex];\n            this.cube_array[5].getComponent(cubeS).setCube(nameStr);\n            var nameStr = this.stopData_array[this.dataIndex];\n            if((this.isSpecialModel == true) && (nameStr == \"WW\") && (this.dataIndex < 4) && (this.unitIndex!= 1)){\n                this.cube_array[5].getComponent(cubeS).playAni();\n            }\n            this.dataIndex++;\n        }\n    },\n});\n\n\n\n\n\n\n\n\n\n"]}